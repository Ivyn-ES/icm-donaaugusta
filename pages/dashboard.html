<script src="../js/script.js"></script>
    <script>
        // Verificação de segurança ao carregar a página
        const user = JSON.parse(localStorage.getItem('usuarioLogado'));
        
        if (!user || !['completa', 'secretaria'].includes(user.permissoes)) {
            window.location.href = '../index.html';
        } else {
            document.getElementById('nomeUsuario').textContent = user.nome;
        }
        
        // Funções de Interface
        function mostrarMudarSenha() { 
            document.getElementById('formSenha').style.display = 'block'; 
            document.getElementById('novaSenha').focus();
        }
        
        function esconderSenha() {
            document.getElementById('formSenha').style.display = 'none';
            document.getElementById('novaSenha').value = '';
        }

        function confirmarNovaSenha() {
            const campoSenha = document.getElementById('novaSenha');
            const novaSenhaLimpa = campoSenha.value.trim(); // Proteção contra espaços acidentais

            if (novaSenhaLimpa.length >= 4) {
                // Chama a função que está no script.js
                const sucesso = mudarSenha(novaSenhaLimpa); 
                
                if (sucesso) {
                    alert('✅ Senha alterada com sucesso!');
                    esconderSenha();
                } else {
                    alert('❌ Erro ao atualizar senha. Tente logar novamente.');
                }
            } else {
                alert('❌ A senha deve ter no mínimo 4 caracteres (sem espaços)!');
            }
        }
    </script>