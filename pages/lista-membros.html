<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Membros - ICM</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container-lista">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button onclick="window.location.href='dashboard.html'" class="btn-voltar">‚¨Ö Voltar</button>
            <h1>Membros Cadastrados</h1>
            <button onclick="window.location.href='cadastro-membro.html'" class="btn-novo">+ Novo</button>
        </header>

        <div class="filtros-lista" style="margin-bottom: 15px;">
            <input type="text" id="buscaMembro" placeholder="üîç Pesquisar por nome..." onkeyup="filtrarLista()" 
                   style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
        </div>

        <div class="tabela-responsiva">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f4f4f4;">
                        <th style="text-align: left; padding: 10px;">Nome</th>
                        <th style="text-align: left;">Categoria</th>
                        <th style="text-align: left;">Grupo</th>
                        <th style="text-align: left;">Situa√ß√£o</th>
                        <th style="text-align: center;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="corpoTabelaMembros">
                    <tr>
                        <td colspan="5" style="text-align:center; padding: 20px;">Carregando membros...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/script.js"></script>
    <script>
        // No Linux/Chrome, o DOMContentLoaded √© mais confi√°vel que window.onload
        document.addEventListener('DOMContentLoaded', async () => {
            verificarAcesso();
            
            // Chama a fun√ß√£o que criamos no script.js
            if (typeof renderizarListaMembros === 'function') {
                await renderizarListaMembros();
            }
        });

        // Fun√ß√£o de filtro local (Busca em tempo real)
        function filtrarLista() {
            const termo = document.getElementById('buscaMembro').value.toLowerCase();
            const linhas = document.querySelectorAll('#corpoTabelaMembros tr');
            
            linhas.forEach(linha => {
                // Verifica se a linha tem dados (evita erro se a tabela estiver vazia)
                if (linha.cells.length > 1) {
                    const nome = linha.cells[0].textContent.toLowerCase();
                    linha.style.display = nome.includes(termo) ? '' : 'none';
                }
            });
        }
    </script>
</body>
</html>