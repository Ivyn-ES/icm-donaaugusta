<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Membros - ICM</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container" style="max-width: 800px;"> <h1>üë• Membros Cadastrados</h1>
        
        <div class="campo">
            <input type="text" id="busca" placeholder="Filtrar por nome..." onkeyup="filtrarTabela()">
        </div>

        <div style="overflow-x: auto;"> <table id="tabelaMembros" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead>
                    <tr style="background-color: #f1f2f6; text-align: left;">
                        <th style="padding: 10px; border-bottom: 2px solid #ddd;">Nome</th>
                        <th style="padding: 10px; border-bottom: 2px solid #ddd;">Categoria</th>
                        <th style="padding: 10px; border-bottom: 2px solid #ddd;">Grupo</th>
                        <th style="padding: 10px; border-bottom: 2px solid #ddd;">Status</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    </tbody>
            </table>
        </div>

        <div class="action-footer">
            <a href="dashboard.html" class="btn-alt-senha" style="text-decoration: none; text-align: center;">Voltar</a>
        </div>
    </div>

    <script src="../js/script.js"></script>
    <script>
        // 1. Verifica se o usu√°rio est√° logado antes de mostrar os dados
        verificarAcesso();

        // 2. Fun√ß√£o que busca os dados no Supabase assim que a p√°gina carrega
async function carregarMembros() {
    const lista = await buscarMembrosBanco();
    const tabela = document.getElementById('corpoTabela');
    tabela.innerHTML = '';

    lista.forEach(membro => {
        const linha = `
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">${membro.nome_completo}</td>
                <td style="padding: 10px;">${membro.grupo}</td>
                <td style="padding: 10px;">
                    <span style="color: ${membro.status_registro === 'Ativo' ? 'green' : 'red'}">
                        ${membro.status_registro}
                    </span>
                </td>
                <td style="padding: 10px; display: flex; gap: 5px;">
                    <button onclick="alternarStatusMembro('${membro.id}', '${membro.status_registro}')" title="Ativar/Desativar" style="cursor:pointer;">üîÑ</button>
                    
                    <button onclick="excluirMembro('${membro.id}')" title="Excluir" style="cursor:pointer; background:#fee; border:1px solid #fcc;">üóëÔ∏è</button>
                </td>
            </tr>
        `;
        tabela.innerHTML += linha;
    });
}
        // Executa a carga dos dados
        carregarMembros();

        // Fun√ß√£o simples de filtro (Puramente HTML/JS local)
        function filtrarTabela() {
            const busca = document.getElementById('busca').value.toLowerCase();
            const linhas = document.getElementById('corpoTabela').getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const nome = linhas[i].getElementsByTagName('td')[0].innerText.toLowerCase();
                linhas[i].style.display = nome.includes(busca) ? "" : "none";
            }
        }
    </script>
</body>
</html>